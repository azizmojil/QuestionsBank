{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "منشئ الاستبيان - منصة QnR" %}{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'surveys/css/builder.css' %}">
{% endblock %}

{% block content %}
<section class="hero builder-hero">
    <div class="card hero-card">
        <h1>{% trans "منشئ الاستبيان" %}</h1>
        <p class="lead">{% trans "أنشئ استبيانات بأقسام وأنواع أسئلة متنوعة (بما فيها المصفوفات)، واجمع الردود التي تحتاجها." %}</p>
        <div class="flex gap-2 mt-3 flex-wrap">
            <a href="#builder-workspace" class="btn">{% trans "ابدأ التركيب" %}</a>
        </div>
    </div>
</section>

<section id="builder-workspace" class="builder-grid">
    <div class="card">
        <h2>{% trans "صمم هيكل استبيانك" %}</h2>
        <form id="builder-form">
            <label class="stacked">
                {% trans "عنوان الاستبيان" %}
                <input id="survey-title" name="survey_title" type="text" placeholder="{% trans 'نبض تجربة العملاء' %}" value="{% trans 'نبض تجربة العملاء' %}">
            </label>
            <div class="flex gap-2 mt-2 wrap">
                <div class="info-block">
                    <p class="eyebrow">{% trans "الأقسام" %}</p>
                    <p class="muted">{% trans "اجمع الأسئلة ذات الصلة لتحسين التسلسل." %}</p>
                </div>
                <div class="info-block">
                    <p class="eyebrow">{% trans "أسئلة المصفوفة" %}</p>
                    <p class="muted">{% trans "حدّد الصفوف والأعمدة وخيارات الاستجابة المشتركة." %}</p>
                </div>
            </div>
            <div class="section-actions mt-3">
                <button type="button" class="btn" id="add-section-btn">{% trans "إضافة قسم" %}</button>
                <button type="button" class="btn btn-secondary" id="load-sample-btn">{% trans "تحميل نموذج هيكل" %}</button>
            </div>
            <div id="sections-container" class="section-container" aria-live="polite"></div>
        </form>
    </div>
</section>

<template id="section-template">
    <div class="card section-block">
        <div class="section-head">
            <div class="stacked">
                <label>{% trans "عنوان القسم" %}
                    <input type="text" class="section-name" placeholder="{% trans 'عنوان القسم' %}">
                </label>
                <label>{% trans "وصف القسم" %}
                    <textarea class="section-description" rows="2" placeholder="{% trans 'صف بإيجاز ما يتضمنه هذا القسم' %}"></textarea>
                </label>
            </div>
            <button type="button" class="btn btn-secondary remove-section">{% trans "حذف القسم" %}</button>
        </div>
        <div class="questions-area">
            <div class="section-header">
                <div>
                    <p class="eyebrow">{% trans "الأسئلة" %}</p>
                    <p class="muted">{% trans "أضف ما تشاء من الأسئلة. غيّر نوع الإجابة لإظهار الخيارات أو شبكات المصفوفة." %}</p>
                </div>
                <button type="button" class="btn add-question">{% trans "إضافة سؤال" %}</button>
            </div>
            <div class="question-list"></div>
        </div>
    </div>
</template>

<template id="question-template">
    <div class="card question-block">
        <div class="question-top">
            <label class="stacked full-width">{% trans "نص السؤال" %}
                <input type="text" class="question-text" placeholder="{% trans 'اطرح سؤالك بوضوح' %}" required>
            </label>
            <div class="question-controls">
                <label class="stacked">{% trans "نوع الإجابة" %}
                    <select class="response-type">
                        {% for rt in response_types %}
                            <option value="{{ rt.value }}">{{ rt.label }}</option>
                        {% endfor %}
                    </select>
                </label>
                <label class="checkbox">
                    <input type="checkbox" class="question-required">
                    <span>{% trans "إلزامي" %}</span>
                </label>
                <button type="button" class="btn btn-secondary remove-question">{% trans "حذف" %}</button>
            </div>
        </div>
        <div class="option-editor hidden">
            <div class="option-row">
                <label class="stacked full-width">{% trans "خيار إجابة" %}
                    <input type="text" class="option-input" placeholder="{% trans 'اكتب خياراً ثم أضفه' %}">
                </label>
                <button type="button" class="btn add-option">{% trans "إضافة خيار" %}</button>
            </div>
            <div class="pill-list" aria-live="polite"></div>
        </div>
        <div class="matrix-editor hidden">
            <div class="matrix-grid">
                <label class="stacked full-width">{% trans "صفوف المصفوفة" %}
                    <textarea class="matrix-rows" rows="3" placeholder="{% trans 'سطر لكل صف' %}"></textarea>
                </label>
                <label class="stacked full-width">{% trans "أعمدة المصفوفة" %}
                    <textarea class="matrix-columns" rows="3" placeholder="{% trans 'سطر لكل عمود' %}"></textarea>
                </label>
            </div>
            <p class="muted">{% trans "تمثل الصفوف محاور مثل سهولة الاستخدام أو السرعة، وتمثل الأعمدة القنوات مثل الويب أو الجوال." %}</p>
        </div>
    </div>
</template>

{{ response_types|json_script:"response-types-data" }}
{{ sample_sections|json_script:"sample-sections-data" }}
<script id="builder-locale" type="application/json">
    {
        "yes": "{% trans 'نعم' %}",
        "no": "{% trans 'لا' %}",
        "untitled": "{% trans 'استبيان بدون عنوان' %}"
    }
</script>
{% endblock %}

{% block extra_js %}
    <script src="{% static 'surveys/js/builder.js' %}"></script>
{% endblock %}
