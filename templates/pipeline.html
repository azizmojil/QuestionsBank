{% extends "base.html" %}
{% load static i18n %}

{% block title %}{% trans "Pipeline" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pipeline.css' %}">
{% endblock %}

{% block content %}
<div class="card progress-card">
  <div class="pipeline-wrap" id="pipelineWrap">
    <!-- SVG overlay for branching connectors -->
    <svg class="pipeline-lines" id="pipelineLines" aria-hidden="true"></svg>

    <!-- 3 lanes (top, middle, bottom) -->
    <div class="pipeline-grid" id="pipelineGrid">
      <!-- ROOT (spans all lanes) -->
      <div class="pnode span-rows col1" data-id="version" data-step="1">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Survey creation" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <!-- PATH 1 (top lane) -->
      <div class="pnode lane1 col2" data-id="self" data-step="2">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Self assessment" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <div class="pnode lane1 col3" data-id="routing" data-step="3">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Routing" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <div class="pnode lane1 col4" data-id="business" data-step="4">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Business" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <!-- PATH 2 (middle lane) -->
      <div class="pnode lane2 col2" data-id="lang" data-step="2A">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Lang review" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <div class="pnode lane2 col3" data-id="translation" data-step="3A">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Translation" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <!-- MERGE GATE (spans top+middle lanes only) -->
      <div class="pnode span-rows-2 col5 gate" data-id="approval" data-step="5">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "Approval" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>

      <!-- THIRD-LEVEL BRANCH (bottom lane): Translation -> QBank -->
      <div class="pnode lane3 col4 post" data-id="qbank" data-step="Q">
        <div class="pnode__circle"></div>
        <div class="pnode__meta">
          <div class="pnode__label">{% trans "QBank" %}</div>
          <div class="pnode__status"></div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Replace from backend when ready
  window.PIPELINE_STATE = window.PIPELINE_STATE || {
    version: 'done',

    self: 'done',
    routing: 'in_progress',
    business: 'not_started',

    lang: 'done',
    translation: 'not_started',

    approval: 'not_started',
    qbank: 'not_started'
  };
</script>
<script src="{% static 'js/pipeline.js' %}"></script>
{% endblock %}
